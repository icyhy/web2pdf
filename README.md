# WeChat Article to PDF Converter

这是一个 Python 自动化工具，用于批量将微信公众号文章导出为 PDF 文件。它通过自动化控制 PC 端微信窗口来获取文章链接，并使用 Playwright 在后台生成高质量的 PDF。

## ✨ 主要特性

*   **批量导出**：自动遍历公众号文章列表，无需手动一个个打开。
*   **智能滚动**：支持自动向下滚动加载更多历史文章。
*   **按需保存**：启动时可灵活指定要保存的文章数量（最新的 N 篇或全部保存）。
*   **高质量 PDF**：
    *   自动处理图片懒加载，确保 PDF 中配图完整。
    *   使用文章真实标题作为文件名（自动过滤非法字符）。
*   **去重机制**：智能识别已处理过的文章，避免重复生成。
*   **高稳定性**：使用 `win32gui` 底层 API 优化窗口查找和焦点控制，解决卡顿和菜单识别问题。

## 🛠️ 环境准备

1.  **Python 3.8+**
2.  **安装依赖库**：
    ```bash
    pip install pywinauto playwright pyperclip pywin32
    playwright install chromium
    ```
3.  **PC 端微信**：请确保微信已登录，并打开了某个公众号的文章列表窗口（如下图所示）。

## 🚀 使用方法

1.  打开 PC 端微信，点击进入某个公众号的历史文章列表页面。
2.  运行脚本：
    ```bash
    python wechat_to_pdf.py
    ```
3.  根据终端提示输入指令：
    *   **输入数字**（如 `5`）：保存最新的 5 篇文章。
    *   **输入 `all`**：不断向下滚动，保存所有可见的文章。
    *   **直接回车**：默认保存最新的 10 篇文章。
4.  脚本运行结束后，PDF 文件将保存在当前目录下的 `results/` 文件夹中。

## 📝 版本更新说明 (Release Notes)

### v1.2.0 (2026-01-23)
*   **New Feature**: 新增列表自动滚动功能，支持获取视野之外的历史文章。
*   **New Feature**: 启动时支持用户输入指令，可指定保存数量（`N`）或保存全部（`all`）。
*   **Improvement**: 引入 URL 去重机制，防止在滚动过程中重复保存同一篇文章。
*   **Fix**: 修复了 `pywinauto` 键盘输入报错问题（修正 `{PAGEDOWN}` 为 `{PGDN}`）。
*   **Fix**: 优化了边缘锚点过滤逻辑，防止点击到窗口边缘导致操作失败。

### v1.1.0
*   **Optimization**: 重构窗口搜索模块，使用 `win32gui` 替代 `UIA` 后端，显著提升句柄查找速度，解决长时间卡顿问题。
*   **Optimization**: 调整“更多”按钮点击坐标（右移 120px），修复误触“最小化”或“摘要”的问题。
*   **Optimization**: PDF 生成逻辑增强，增加平滑滚动操作以触发图片懒加载，确保 PDF 配图不丢失。
*   **Optimization**: 改进文件命名规则，使用网页真实 `title` 并自动过滤 Windows 文件名非法字符。
*   **Fix**: 修复脚本卡在“寻找复制链接”菜单的问题，引入句柄差异检测法快速锁定菜单窗口。

### v1.0.0
*   Initial Release: 基础功能实现。
*   支持自动定位公众号窗口和文章锚点。
*   支持点击文章、复制链接、生成 PDF 的全流程自动化。
